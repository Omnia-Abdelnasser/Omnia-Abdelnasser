$(function(){var window_title,meta_url,area_contents,loadbar,alt_vectors,header,header_expanded,alt_results,nav_top,nav_bottom,grid,grid_expanded,search_similar,search_noresults,area_vectors,search_total,panel,support_history=null,has_history=!1,is_pushstate=!1,page_order=null,page_index=1,page_total=1,order_set=!1,preferred_filetype=!1,original_params=null;function onSearchboxChange(params){var is_keywords;VectorStock.search_box.mode===SearchBox.MODE_DYNAMIC&&(is_keywords=!!params.keywords,nav_top.setKeywordsExist(is_keywords),nav_top.setArtistExist(!!params.artists),nav_top.setSimilarSearch(!!params.similar),is_keywords&&!order_set?(page_order=SearchMosiacQuery.ORDER_BESTMATCH,nav_top.setOrder(page_order,!0)):(!is_keywords&&page_order===SearchMosiacQuery.ORDER_BESTMATCH||params.similar&&page_order===SearchMosiacQuery.ORDER_ISOLATED)&&(page_order=SearchMosiacQuery.ORDER_TRENDING,nav_top.setOrder(page_order,!0)),!is_keywords&&alt_results&&alt_results.empty(),page_index=1,nav_top.setPageIndex(page_index,!0),nav_bottom.setPageIndex(page_index,!0),search(),alt_vectors.remove())}function onPageNavigation(index){page_index=index,search()}function getSearchParameters(){var searchbox_value=VectorStock.search_box.getValue(),searchbox_value=new SearchMosaicParameters(searchbox_value);return searchbox_value.setOrder(page_order),searchbox_value.setPage(page_index),searchbox_value}function setupExpandedSearchResults(){var area_vectors_expanded=$('.search_mosaic[data-container="expanded"]',area_contents),area_vectors_expanded=(area_vectors_expanded.length&&!grid_expanded&&(grid_expanded=new SearchMosaicGrid({container:area_vectors_expanded,layout_type:area_vectors_expanded.data("layout"),search:VectorStock.search_box.getValue(),filetype:preferred_filetype,track_layout:!1})),$('.search_header[data-container="expanded"]'));area_vectors_expanded.length&&!header_expanded&&(header_expanded=new SearchMosaicHeader(area_vectors_expanded))}function updateHeader(search_params,response){var empty_search=null===search_params.getArtist()&&null===search_params.getCategory()&&null===search_params.getKeywords()&&null===search_params.getSimilar();header.setSearch(!empty_search),header.setTitle(search_params.getPageTitle()),empty_search?"free"===VectorStock.search_box.getValue().scope&&(header.setLoading(!response),response&&header.setSubtitle(search_params.getPageSubtitle(response.total))):(header.setLoading(empty_search=!response),empty_search||(response.spelling?header.setSubtitle('Or show results for <a href="'+response.spelling.original_url+'?noredirect=1">'+response.spelling.original+"</a> instead..."):response.initial_results||0===response.total_hits&&response.results.length?1==response.page?(header.setSubtitle(search_params.getPageSubtitle(response.total_hits)),header_expanded&&(header_expanded.setTitle("Related search results"),header_expanded.setSubtitle(search_params.getPageSubtitle(response.total,!0)))):header.setSubtitle(search_params.getPageSubtitle(response.total,!0)):header.setSubtitle(search_params.getPageSubtitle(response.total)))),response&&response.artist_id&&(VectorStock.userData.isFollowing(response.artist_id)&&header.selectFollowButton(),VectorStock.userData.isNotFollowing(response.artist_id)&&header.selectHideButton())}function populateResults(search_params,search_state,response){loadbar&&(loadbar.complete(),loadbar=null),response&&(response.url_canonical&&search_params.setURL(response.url_canonical),response.display&&(response.display.window_title&&search_params.setWindowTitle(response.display.window_title),response.display.page_title&&search_params.setPageTitle(response.display.page_title),response.display.page_subtitle&&search_params.setPageSubtitle(response.display.page_subtitle))),updateURL(search_params),window_title.html(search_params.getWindowTitle()),response&&(results_exact=0===response.total_hits?[]:response.initial_results||response.results,results_expanded=response.initial_results||0===response.total_hits?response.results:[],response.spelling?(response.spelling.original_url=search_params.getURL(),search_params.setKeywords(response.spelling.updated),VectorStock.search_box.setSearch(response.spelling.updated,!0),updateURL(search_params,!0),window_title.html(search_params.getWindowTitle())):response.is_artist&&(search_params.setArtist(response.is_artist),search_params.setKeywords(null),nav_top.setKeywordsExist(!1),nav_top.setSimilarSearch(!1),nav_top.setArtistExist(!0),VectorStock.search_box.setSearch("",!0),VectorStock.search_box.setArtist(response.is_artist,!0),search_params.getOrder()===SearchMosiacQuery.ORDER_BESTMATCH&&(page_order=SearchMosiacQuery.ORDER_TRENDING,search_params.setOrder(page_order),nav_top.setOrder(page_order,!0)),updateURL(search_params),window_title.html(search_params.getWindowTitle())),search_params.getSimilar()&&search_params.getOrder()===SearchMosiacQuery.ORDER_ISOLATED&&(page_order=SearchMosiacQuery.ORDER_TRENDING,search_params.setOrder(page_order),nav_top.setOrder(page_order,!0)),results_expanded.length&&1===response.page?((area_vectors_expanded=$('.search_mosaic[data-container="expanded"]',area_contents)).length||(area_vectors_expanded=$('<div class="search_mosaic" data-layout="mosaic" data-container="expanded" />').insertAfter("#filter_pagination_top")),$('.search_header[data-container="expanded"]').length||$('<div class="search_header search" data-container="expanded"><h1></h1><h2></h2></div>').insertAfter(area_vectors_expanded),setupExpandedSearchResults()):grid_expanded&&header_expanded&&(grid_expanded.remove(),grid_expanded=null,header_expanded.remove(),header_expanded=null));var results_exact,results_expanded,area_vectors_expanded=!response||0===response.total,alt_results=!!(response&&response.altresults&&response.altresults.documents);header.setNoSeparator(area_vectors_expanded||alt_results),nav_top.setVisible(!area_vectors_expanded),nav_bottom.setVisible(!area_vectors_expanded),search_noresults&&(search_noresults.remove(),search_noresults=null),area_vectors_expanded&&(alt_results=response?SearchMosaicNoResults.TYPE_EMPTY:SearchMosaicNoResults.TYPE_FAILED,search_noresults=new SearchMosaicNoResults(area_contents,alt_results)),response?(page_total=response.pages,updateHeader(search_params,response),nav_top.setPageTotal(response.pages),nav_bottom.setPageTotal(response.pages),results_expanded.length?(grid.populate(results_expanded,search_state),1===response.page&&(results_exact.length?grid_expanded.populate(results_exact,search_state):grid_expanded.showEmptyScreen())):grid.populate(results_exact,search_state),response.similar_searches?search_similar.set(response.similar_searches):1==response.page&&search_similar.clear()):(header.setLoading(!1),header.setSubtitle("Failed to load results"),grid.empty(),search_similar.clear()),VectorStock.scrollTo(0,500,"easeOutExpo"),is_pushstate=!1}function updateURL(search_params,update_only){var search_state,search_title,search_url;support_history&&!is_pushstate&&(search_state=search_params.formatObjectData(),search_title=search_params.getWindowTitle(),search_url=search_params.getURL(),update_only?window.history.replaceState(search_state,search_title,search_url):window.history.pushState(search_state,search_title,search_url),meta_url.attr("content",location.protocol+VectorStock.host+search_params.getURL()),has_history=!0)}function search(){var search_params=getSearchParameters(),search_query=new SearchMosiacQuery(search_params),search_state=VectorStock.search_box.getValue();search_params.getID(),window_title.html(search_params.getWindowTitle()),updateHeader(search_params),search_query.on(SearchMosiacQuery.LOAD_INIT,function(search_id,params){VectorStock.search_box.setStatus(SearchBox.STATUS_LOADING),alt_results&&alt_results.empty(),header.setNoSeparator(!1),grid.disable(),grid_expanded&&grid_expanded.disable(),loadbar=SearchLoadBar()}),search_query.on(SearchMosiacQuery.LOAD_CACHED,function(search_id,cache_response,params){search_id===search_params.getID()&&(VectorStock.search_box.setStatus(SearchBox.STATUS_READY),alt_results&&cache_response.altresults&&alt_results.populate(search_params,cache_response.altresults),grid.enable(),grid_expanded&&grid_expanded.enable(),populateResults(search_params,search_state,cache_response))}),search_query.on(SearchMosiacQuery.LOAD_PROGRESS,function(search_id,progress){loadbar&&search_id===search_params.getID()&&loadbar.update(progress)}),search_query.on(SearchMosiacQuery.LOAD_COMPLETE,function(search_id,response,params){search_id===search_params.getID()&&(response.redirect?VectorStock.goToURL(response.redirect):response.is_vector&&0===response.results.length?VectorStock.goToURL(response.altresults.url):(VectorStock.search_box.setStatus(SearchBox.STATUS_READY),alt_results&&response.altresults&&alt_results.populate(search_params,response.altresults),grid.enable(),grid_expanded&&grid_expanded.enable(),populateResults(search_params,search_state,response)))}),search_query.on(SearchMosiacQuery.LOAD_FAILED,function(search_id,response,params){search_id===search_params.getID()&&(VectorStock.search_box.setStatus(SearchBox.STATUS_READY),grid.enable(),grid_expanded&&grid_expanded.enable(),populateResults(search_params,search_state))}),search_query.run(),$("#banner-lang-switch").animate({height:0,"padding-bottom":0,"padding-top":0},400,"swing",function(){$(this).remove()})}area_contents=$("article"),area_header=$('.search_header[data-container="core"]'),area_vectors=$('.search_mosaic[data-container="core"]',area_contents),support_history=!(!window.history||!history.pushState),page_order=$('input[name="contents_order"]:checked').val(),page_index=parseInt($("#search_page",area_vectors).val()||page_index),page_total=parseInt($("#search_pages",area_vectors).val()||page_total),search_total=parseInt($("#search_total",area_vectors).val()||0),preferred_filetype=$("#account_filetype",area_vectors).val()||preferred_filetype,window_title=$("head title"),meta_url=$('meta[property="og:url"]'),alt_vectors=new SearchAlternative(area_header,$(".altresults")),header=new SearchMosaicHeader(area_header),(area_header=$(".search_altresults")).length&&(alt_results=new SearchMosaicAltResults(area_header)),nav_top=new SearchMosaicPagination($("#filter_pagination_top"),page_index,page_total),nav_bottom=new SearchMosaicPagination($("#filter_pagination_bottom"),page_index,page_total),setupExpandedSearchResults(),grid=new SearchMosaicGrid({container:area_vectors,layout_type:area_vectors.data("layout"),search:VectorStock.search_box.getValue(),filetype:preferred_filetype,track_layout:!1}),search_similar=new SearchSimilar($("#nav_sidebar")),(area_header=$(".search_noresults",area_contents)).length&&(search_noresults=new SearchMosaicNoResults(area_contents,area_header.data("type"),area_header)),(area_header=$("#admin-panel")).length&&(artist_id=area_header.data("artist-id"),panel=new AdminPanel(area_header,null,artist_id),VectorStock.search_box.on("change",function removeAdminPanel(){panel.remove();VectorStock.search_box.off("change",removeAdminPanel)}));var area_header=$('meta[itemprop="noResultsEmptyHTML"]',area_vectors).attr("content"),artist_id=(SearchMosaicNoResults.HTML_MESSAGE_EMPTY=area_header||SearchMosaicNoResults.HTML_MESSAGE_EMPTY,$('meta[itemprop="noResultsFailedHTML"]',area_vectors).attr("content"));SearchMosaicNoResults.HTML_MESSAGE_FAILED=artist_id||SearchMosaicNoResults.HTML_MESSAGE_FAILED,original_params=getSearchParameters(),original_params.getID(),(area_header={}).page=page_index,area_header.pages=page_total,area_header.total=search_total,area_header.results=grid.getDataFormatted(),grid_expanded&&(area_header.initial_results=grid_expanded.getDataFormatted(),area_header.total_hits=area_header.initial_results.length),SearchMosiacQuery.storeInCache(original_params,area_header),VectorStock.search_box.on("change",onSearchboxChange),nav_top.on("navigate",function(index){nav_bottom.setPageIndex(index),onPageNavigation(index)}),nav_top.on("reorder",function(order){page_order=order,page_index=1,order_set=!0,search()}),nav_top.on("layout_change",function(layout_type){grid.updateLayout(layout_type),grid_expanded&&grid_expanded.updateLayout(layout_type)}),grid.on("view_similar",function(similar_id,event){VectorStock.search_box.getScope()===SearchResults.SCOPE_ALL&&(VectorStock.search_box.setSimilar(similar_id),event.preventDefault(),event.stopPropagation())}),nav_bottom.on("navigate",function(index){nav_top.setPageIndex(index),onPageNavigation(index)}),window.addEventListener("popstate",function(event){var search_params;has_history&&(is_pushstate=!0,search_params=original_params,event.state&&(search_params=new SearchMosaicParameters(event.state)),VectorStock.search_box.setValue(search_params.formatObjectData(),!0),page_order=search_params.getOrder(),page_index=search_params.getPage(),nav_top.setKeywordsExist(!!search_params.getKeywords()),nav_top.setArtistExist(!!search_params.getArtist()),nav_top.setSimilarSearch(!!search_params.getSimilar()),nav_top.setOrder(page_order,!0),nav_top.setPageIndex(page_index,!0),nav_bottom.setPageIndex(page_index,!0),search())})});